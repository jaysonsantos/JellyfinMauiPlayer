<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
  xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
  xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
  xmlns:viewModels="clr-namespace:Player.ViewModels"
  xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
  xmlns:views="clr-namespace:Mpv.Maui.Controls;assembly=Mpv.Maui"
  x:Class="Player.Pages.VideoPlayerPage"
  x:DataType="viewModels:VideoPlayerViewModel"
  Title="{Binding ItemName}"
  NavigationPage.HasNavigationBar="False"
>
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>
    <!-- Video Player -->

    <views:Video x:Name="MpvElement" Grid.Row="0" Source="{Binding VideoUrl}" />

    <!-- Loading Indicator -->
    <ActivityIndicator
      Grid.Row="0"
      IsRunning="{Binding IsLoading}"
      IsVisible="{Binding IsLoading}"
      Color="{DynamicResource VideoTextColor}"
      VerticalOptions="Center"
      HorizontalOptions="Center"
    />

    <!-- Error Message -->
    <Border
      Grid.Row="0"
      IsVisible="{Binding ErrorMessage, Converter={StaticResource IsStringNotNullOrEmptyConverter}}"
      BackgroundColor="{DynamicResource VideoOverlay80}"
      Padding="20"
      VerticalOptions="Center"
      HorizontalOptions="Center"
    >
      <Border.StrokeShape>
        <RoundRectangle CornerRadius="8" />
      </Border.StrokeShape>
      <VerticalStackLayout Spacing="10">
        <Label
          Text="Playback Error"
          FontSize="18"
          FontAttributes="Bold"
          TextColor="{DynamicResource VideoTextColor}"
          HorizontalOptions="Center"
        />
        <Label
          Text="{Binding ErrorMessage}"
          FontSize="14"
          TextColor="{DynamicResource VideoTextColor}"
          HorizontalOptions="Center"
          MaximumWidthRequest="300"
        />
        <Button
          Text="Close"
          Command="{Binding CloseCommand}"
          BackgroundColor="{DynamicResource PrimaryColor}"
          TextColor="{DynamicResource VideoTextColor}"
          Margin="0,10,0,0"
        />
      </VerticalStackLayout>
    </Border>

    <!-- Debug info strip -->
    <Grid Grid.Row="1" Padding="8" BackgroundColor="{DynamicResource VideoOverlay87}">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>
      <Label
        Text="Debug URL:"
        TextColor="{DynamicResource VideoTextColor}"
        FontAttributes="Bold"
        VerticalOptions="Center"
      />
      <ScrollView Grid.Column="1" Orientation="Horizontal">
        <Label
          Text="{Binding VideoUrl}"
          TextColor="{DynamicResource VideoTextColor}"
          LineBreakMode="NoWrap"
          VerticalOptions="Center"
        />
      </ScrollView>
    </Grid>

    <!-- Custom Controls Overlay (Optional - MediaElement has built-in controls) -->
    <Grid
      Grid.Row="2"
      Padding="10"
      BackgroundColor="{DynamicResource VideoOverlay80}"
      IsVisible="{Binding ShowCustomControls}"
    >
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>

      <!-- Play/Pause Button -->
      <Button
        Grid.Column="0"
        Text="{Binding IsPlaying, Converter={StaticResource PlayPauseConverter}}"
        Command="{Binding TogglePlayPauseCommand}"
        BackgroundColor="{DynamicResource TransparentColor}"
        TextColor="{DynamicResource VideoTextColor}"
        FontSize="24"
        WidthRequest="60"
      />

      <!-- Position Display -->
      <HorizontalStackLayout Grid.Column="1" Spacing="10" VerticalOptions="Center">
        <Label
          Text="{Binding CurrentPositionText}"
          TextColor="{DynamicResource VideoTextColor}"
          FontSize="12"
          VerticalOptions="Center"
        />
        <Label
          Text="/"
          TextColor="{DynamicResource VideoTextColor}"
          FontSize="12"
          VerticalOptions="Center"
        />
        <Label
          Text="{Binding DurationText}"
          TextColor="{DynamicResource VideoTextColor}"
          FontSize="12"
          VerticalOptions="Center"
        />
      </HorizontalStackLayout>

      <!-- Close Button -->

      <Button
        Grid.Column="2"
        Text="âœ•"
        Command="{Binding CloseCommand}"
        BackgroundColor="{DynamicResource TransparentColor}"
        TextColor="{DynamicResource VideoTextColor}"
        FontSize="24"
        WidthRequest="60"
      />
    </Grid>
  </Grid>
</ContentPage>
